const forms_observingNodesKeys=["input","button","checkbox","selectionField","link","inputWrapper","rangeBlock","imageBlock"];function justifyAddButtonsHeight(){function t(){[".add-field--education"].forEach((t=>{const e=Array.from(document.querySelectorAll(t));e.forEach((t=>t.style.removeProperty("min-height")));const i=e.map((t=>t.offsetHeight)),s=Math.max(...i);e.forEach((t=>t.style.minHeight=`${s}px`))}))}t(),window.addEventListener("resize",t)}justifyAddButtonsHeight();class AddFields{constructor(t){if(this.button=t,this.container=t.closest(".forms__container"),this.maxFields=parseInt(t.dataset.addMax)||100,this.showAmount=parseInt(t.dataset.addShow)||0,this.removeButton=createElement("button","add-field__remove"),this.fields=[],t.removeAttribute("data-add-max"),t.removeAttribute("data-add-show"),this.title=this.container.querySelector(".add-field__title"),this.groups=Array.from(this.container.querySelectorAll("[data-add-group]")),this.fieldsAmount=0,this.askConfirmation=this.askConfirmation.bind(this),this.groups.forEach((t=>t.remove())),t.addEventListener("click",(()=>this.addField())),this.showAmount)for(let t=0;t<this.showAmount;t++)this.addField()}addField(){if(this.fieldsAmount+1>this.maxFields)return;this.fieldsAmount++;const t=this.groups.map((t=>t.cloneNode(!0)));if(this.fields.push(t),t.forEach((t=>this.addGroup(t))),this.fieldsAmount>this.showAmount){const e=createElement("button","add-field__remove-button icon-bin","Удалить блок");e.setAttribute("title","Удалить блок"),t[t.length-1].before(e),e.addEventListener("click",(i=>{i.preventDefault(),this.askConfirmation(t,e)}))}this.container.append(this.button),this.fieldsAmount>=this.maxFields&&this.button.remove()}addGroup(t){if(t.dataset.addGroup){const e=parseInt(t.dataset.addGroup.split(":")[1]);if(e){if(this.fieldsAmount<=e&&e>0)return;if(e<0&&this.fieldsAmount>Math.abs(e))return}}const e=`_${this.fieldsAmount}`;t.removeAttribute("data-add-group");const i=Array.from(t.querySelectorAll("input"));Array.from(t.querySelectorAll("label")).forEach((t=>{const i=t.getAttribute("for");i&&t.setAttribute("for",i+e)})),i.forEach((t=>{const i=t.getAttribute("id"),s=t.getAttribute("name");i&&t.setAttribute("id",i+e),s&&t.setAttribute("name",s+e)})),this.container.append(t)}askConfirmation(t,e){function i(){e.remove(),this.removeField(t)}i=i.bind(this),modal.createBasicModal("Удалить блок?","Будет удален выбранный блок",{text:"Удалить",confirmCallback:i},{text:"Не удалять"}),modal.getModalBody().classList.add("modal__body--small")}removeField(t){const e=this.fields.findIndex((e=>e===t));if(e>=0){this.fields[e].forEach((t=>t.remove())),this.fields.splice(e,1),this.fieldsAmount--}this.fieldsAmount<this.maxFields&&this.container.append(this.button)}}class AddFieldsCheckbox{constructor(t){this.checkbox=t,this.addGroupName=t.dataset.addGroupCheckbox,this.group=t.closest(".forms__fields-group"),this.addFields=Array.from(this.group.querySelectorAll(`[data-add-group="${this.addGroupName}"]`)),this.toggleGroups(),this.checkbox.addEventListener("change",(()=>this.toggleGroups()))}toggleGroups(){this.checkbox.checked?this.addGroup():this.removeGroup()}addGroup(){this.addFields.map((t=>t)).reverse().forEach((t=>{t.closest("body")||this.checkbox.parentNode.after(t),t.removeAttribute("data-add-group")}))}removeGroup(){this.addFields.forEach((t=>t.remove()))}}class InputGroup{group;inputParams;uncompleteParagraph;constructor(t,e){this.group=t;this.group.querySelector(".forms__fields-uncompleted:not(.__mobile)")||(this.uncompleteParagraph=createElement("p","forms__fields-uncompleted __desktop"),this.group.append(this.uncompleteParagraph));const i=Array.from(t.querySelectorAll("input")).map((t=>t.name));this.inputParams=e.filter((t=>i.includes(t.name))),this.inputParams.forEach((t=>{t.inputs?t.inputs.forEach((t=>{t.addEventListener("change",this.checkCompletion.bind(this)),document.querySelector("#form").addEventListener("submit",this.checkCompletion.bind(this))})):t.input&&t.input.addEventListener("blur",this.checkCompletion.bind(this))}))}checkCompletion(){setTimeout((()=>{const t=this.inputParams.filter((t=>!t.isCompleted));Boolean(t.length>0)?(this.group.classList.add("__uncomplete"),this.createUncompleteMessage(t)):this.group.classList.remove("__uncomplete")}),0)}createUncompleteMessage(t){if(this.uncompleteParagraph){let e="";const i=t.map((t=>t.ariaLabel));i[0]&&(i.forEach(((t,i)=>{t=t.toLowerCase(),e+=0==i?" "+t:", "+t})),e&&(e+=".",this.uncompleteParagraph.textContent="Пожалуйста, укажите: "+e))}}}class Input{fieldGroup;name;ariaLabel;constructor(t){this.fieldGroup=t.closest(".forms__fields-group")}}class TextInput extends Input{input;inputWrapper;inputGroup;completeCondition;mask;options;constructor(t){super(t),this.input=t,this.name=t.name,this.ariaLabel=t.getAttribute("aria-label"),this.inputGroup=this.input.closest(".forms__fields-group"),this.input.classList.contains("field__wrapper")?this.inputWrapper=this.input:this.inputWrapper=this.input.closest(".field__wrapper"),t.dataset.mask&&this.createMask(),this.getCompleteConditions(),this.getOptions(),this.input.addEventListener("focus",this.onFocus.bind(this)),this.input.addEventListener("blur",this.onBlur.bind(this)),this.input.addEventListener("change",this.onBlur.bind(this)),this.input.hasAttribute("data-numbers-only")&&this.input.addEventListener("input",this.typeNumberOnly.bind(this))}getCompleteConditions(){const t=this.mask,e=this.input.dataset.completeLength,i=this.input.hasAttribute("data-complete-match");if(t){let e,i=t.length;this.completeCondition={minLength:i,maxLength:e}}else if(e){const t=e.split(", ");this.completeCondition={minLength:t[0],maxLength:t[1]}}else if(i){let t=this.input.dataset.completeMatch,e=[];e=t?t.split("|"):Array.from(document.querySelectorAll(".field__options-item")).map((t=>t.textContent||t.innerText)),this.completeCondition={match:e}}else this.completeCondition={minLength:0}}getOptions(){this.options=Array.from(this.inputWrapper.closest(".field").querySelectorAll(".field__options-item")),this.options.forEach((t=>{t.addEventListener("pointerdown",(()=>{this.input.focus(),this.input.value=t.textContent||t.innerText}))}))}onFocus(){this.inputWrapper.classList.add("__focus")}onBlur(){this.checkCompletion(),this.inputWrapper.classList.remove("__focus")}typeNumberOnly(t){const e=t.data;parseInt(e)>=0||(t.target.value=t.target.value.replace(e,"_"))}createMask(){const t=this.input.dataset.mask;if(!t)return;this.mask=t,this.input.removeAttribute("data-mask"),i=i.bind(this),this.mask=t;const e=this.input;function i(i){const s=t.split("");let n="";if("input"===i.type&&i.data){const t=e.value.split(""),i=t.splice(e.selectionStart-1,1);e.value=t.join("")+i}for(let t=0;t<s.length;t++){if("_"===s[t]){if(e.value[t]){n+=e.value[t];continue}break}n+=s[t]}e.value=n}e.hasAttribute("placeholder")||e.setAttribute("placeholder",t),e.addEventListener("focus",i),e.addEventListener("pointerdown",i),e.addEventListener("input",i)}tabBetweenInputs(t){const e=t.target,i=e.getAttribute("maxlength");if(e.value.length==i||0==e.value.length){const i=e.parentNode,s=Array.from(i.childNodes).filter((t=>t.classList.contains("field__input"))),n=s.findIndex((t=>t==e));if(t.data||0!=e.value.length){const t=s[n+1];t&&t.focus()}else{const t=s[n-1];t&&t.focus()}}}checkCompletion(){const t=this.completeCondition;let e=this.input.value;if(t.match)t.match.includes(e)?this.isCompleted=!0:this.isCompleted=!1;else if(t.minLength>=0){let i=!1;i=t.maxLength?e.length>=t.minLength&&e.length<=t.maxLength:e.length>=t.minLength,this.input.value.includes("_")&&(i=!1),this.isCompleted=i}this.setCompletedState()}setCompletedState(){if(!0===this.isCompleted)this.inputWrapper.classList.remove("__uncomplete");else this.inputWrapper.classList.add("__uncomplete")}}class TextSelect extends TextInput{constructor(t){super(t),this.optionsUl=this.inputWrapper.querySelector(".text-select__options"),this.optionItems=this.inputWrapper.querySelectorAll(".text-select__option-item"),this.setItemsHandler()}setItemsHandler(){this.optionItems.forEach((t=>{t.addEventListener("pointerdown",(t=>{this.input.value=t.target.textContent||t.target.innerText,this.input.dispatchEvent(new Event("change"))}))}))}}class TextSelectWorkYear extends TextSelect{constructor(t){super(t),this.maxYears=30,this.setValues(),this.input.addEventListener("change",this.checkCompletion.bind(this))}setValues(){this.currentYear=(new Date).getFullYear(),this.oldestYear=this.currentYear-this.maxYears,this.optionsUl.innerHTML="",this.optionItems=[];for(let t=1;t<=this.maxYears;t++){const e=createElement("li","text-select__option-item",this.currentYear-t);this.optionsUl.append(e),this.optionItems.push(e)}this.setItemsHandler()}checkCompletion(){const t=parseInt(this.input.value)||0;t>this.currentYear||t<this.oldestYear?(this.isCompleted=!1,this.input.closest(".field__input").classList.add("__uncomplete")):(this.isCompleted=!0,this.input.closest(".field__input").classList.remove("__uncomplete")),super.setCompletedState()}}class TextInputMulti extends TextInput{constructor(t){super(t),this.onKeydown=this.onKeydown.bind(this),this.inputWrapper=t,this.inputWrapper.querySelector("input[type='hidden']")?(this.input=this.inputWrapper.querySelector("input[type='hidden']"),this.name=this.input.name,this.existed=!0):(this.input=createElement("input"),this.input.setAttribute("type","hidden"),this.input.setAttribute("name",t.dataset.name),this.name=this.input.name,this.inputWrapper.append(this.input),this.existed=!1),this.fieldNameBlock=this.inputWrapper.closest(".field").querySelector(".field__name"),this.fieldNameBlock&&(this.ariaLabel=this.fieldNameBlock.textContent),this.inputs=Array.from(this.inputWrapper.querySelectorAll("input[type='text']")),this.inputs.forEach((t=>{t.hasAttribute("data-numbers-only")&&t.addEventListener("input",this.typeNumberOnly.bind(this)),t.addEventListener("input",this.setValue.bind(this)),t.addEventListener("keydown",this.onKeydown),t.style.textAlign="center"}))}typeNumberOnly(t){super.typeNumberOnly(t)}checkCompletion(){super.checkCompletion()}setValue(t){const e=t.target;let i="";if(this.inputs.forEach((t=>i+=t.value)),this.input.value=i,e.value.length>=e.getAttribute("maxlength")){const t=this.inputs.indexOf(e),i=this.inputs[t+1];i&&i.focus()}}onKeydown(t){const e=t.target,i=this.inputs.findIndex((t=>t===e)),s=this.inputs[i+1],n=this.inputs[i-1];"Backspace"===t.code&&!e.value&&n&&n.focus(),t.code.includes("Arrow")&&e.selectionStart===e.selectionEnd&&("ArrowRight"===t.code&&e.selectionEnd===e.value.length&&s&&s.focus(),"ArrowLeft"===t.code&&0===e.selectionStart&&n&&n.focus()),this.replaceNextValueSymbol(t)}replaceNextValueSymbol(t){const e=t.target;if(t.key.length>1||e.selectionStart!==e.selectionEnd)return;const i=e.selectionStart,s=e.getAttribute("maxlength");e.value.length==s&&(e.value=e.value.slice(0,i),setTimeout((()=>{e.selectionStart=e.selectionEnd=i+1}),0))}}class TextInputTags extends TextInput{addButton;tags;list;constructor(t){super(t),this.tags=[],this.addButton=this.inputWrapper.querySelector(".field-tags__add-icon"),this.addButton.addEventListener("click",this.addTag.bind(this)),t.addEventListener("keydown",(t=>{13==t.keyCode&&this.addTag()}))}addTag(){this.list||(this.list=createElement("ul","tags-list"));const t=createElement("li","tags-list__item"),e=this.input.value.trim();if(!e||this.tags.find((t=>t.querySelector("input").value===e)))return;this.list.closest("body")||this.inputWrapper.parentNode.append(this.list);const i=createElement("button","tags-list__item-remove icon-close");i.addEventListener("click",(e=>{e.pointerType&&this.removeTag(t)})),t.insertAdjacentHTML("afterbegin",`<input name="${this.name}" type="hidden" disabled value="${e}">`),t.insertAdjacentHTML("afterbegin",`<span class="tags-list__item-text">${e}</span>`),t.append(i),t.setAttribute("title",e),this.list.append(t),this.tags.push(t),this.handleTagItemWidth(t),this.input.value="",this.checkCompletion()}handleTagItemWidth(t){s=s.bind(this);const e=t.querySelector(".tags-list__item-text"),i=t.querySelector(".tags-list__item-remove");function s(){if(!t.closest("body"))return window.removeEventListener("resize",s);this.rootContainer||(this.rootContainer=document.querySelector(".container"));const o=this.rootContainer.clientWidth-i.offsetWidth-10,a=t.cloneNode(!0);a.style.cssText="position: absolute; z-index: -999; opacity: 0",this.rootContainer.append(a),e.textContent=n(e.textContent,a,o,85),t.offsetWidth>o-10&&(t.style.marginRight="0px"),a.remove()}function n(t,e,i,s){let o=t.length>s?t.substring(0,s-3)+"...":t;return e.querySelector(".tags-list__item-text").textContent=o,e.offsetWidth>i?n(o,e,i,s-1):o}window.addEventListener("resize",s),s()}removeTag(t){const e=this.tags.indexOf(t);this.tags.splice(e,1),t.remove(),this.tags.length<1&&this.list.remove()}checkCompletion(){if(!this.input.closest("body"))return this.isCompleted=!0;this.isCompleted=this.tags.length>0,this.setCompletedState()}}class TextInputDate extends TextInputMulti{constructor(t){super(t),this.currentYear=(new Date).getFullYear(),t.addEventListener("change",this.checkCompletion.bind(this)),this.inputs.forEach(((t,e)=>{t.addEventListener("input",this.checkCompletion.bind(this)),t.addEventListener("blur",this.checkCompletion.bind(this)),e==this.inputs.length-1?t.addEventListener("keydown",this.moveValueToLeft.bind(this)):t.addEventListener("input",this.replaceNextSubvalue.bind(this))})),this.inputsLength=this.inputs.map((t=>{const e=t.getAttribute("maxlength");return{input:t,maxlength:e}}))}setValue(t){const e=t.target;let i="";this.inputs.forEach((t=>i+=t.value)),this.input.value=i;const s=this.inputsLength.find((t=>t.input==e)).maxlength;if(e.value.length>=s){const t=this.inputs.indexOf(e),i=this.inputs[t+1];i&&i.focus()}}moveValueToLeft(t){const e=t.target,i=this.inputs.findIndex((t=>t===e)),s=this.inputs[i-1];let n=this.inputs.map((t=>t.value)).join("");const o=this.inputs.filter(((t,e)=>e<i));if(t.key){n+=t.key;const a=o.find((t=>t.value.length<t.getAttribute("maxlength")));e.value.length==e.getAttribute("maxlength")&&this.inputs.length-1===i&&s&&a&&!n.match(/\D/g)&&(this.inputs[2].value=n.slice(-4),this.inputs[1].value=n.slice(-6,-4),this.inputs[0].value=n.slice(-8,-6))}}replaceNextSubvalue(t){if(!t.data&&"insertFromPaste"!==t.inputType||!t.isTrusted)return;const e=t?t.target:null;if(e){const i=this.inputsLength.find((t=>t.input==e)).maxlength;if("insertFromPaste"===t.inputType){const t=e.value.split("");return t.splice(i),void(e.value=t.join(""))}if(e.value.length>i){const s=t.data.length>i?i:t.data.length;e.selectionEnd=e.selectionStart+s,e.setRangeText(""),e.selectionEnd<i&&e.focus()}e.value.length>i&&(e.selectionStart-=1,e.selectionEnd=e.selectionStart+1,e.setRangeText(""))}}checkCompletion(){this.validate(),this.isCompleted=!!this.isValid,super.setCompletedState()}validate(){const t=this.input.value.split("").filter((t=>parseInt(t)>=0)).join("");if(!parseInt(t))return;const e=Number(t[0]+t[1]),i=Number(t[2]+t[3]),s=Number(t.slice(-4)),n=(new Date).getFullYear(),o=n-s,a=o<10||o>=100;return e<1||e>=32||e>29&&"2"==i||e>30&&("4"==i||"6"==i||"9"==i||"11"==i)||(i<1||i>12)?this.isValid=!1:(this.isValid=!0,{day:e,month:i,year:s,currentYear:n,age:o,invalidYear:a})}}class TextInputBirthDate extends TextInputDate{zodiacSigngs;constructor(t){super(t),this.zodiacSigngs=[{name:"Водолей",startMonth:1,startDay:21,endDay:18,iconName:"aquarius"},{name:"Рыбы",startMonth:2,startDay:19,endDay:20,iconName:"pisces"},{name:"Овен",startMonth:3,startDay:21,endDay:19,iconName:"aries"},{name:"Телец",startMonth:4,startDay:20,endDay:20,iconName:"taurus"},{name:"Близнецы",startMonth:5,startDay:21,endDay:20,iconName:"gemini"},{name:"Рак",startMonth:6,startDay:21,endDay:22,iconName:"cancer"},{name:"Лев",startMonth:7,startDay:23,endDay:22,iconName:"leo"},{name:"Дева",startMonth:8,startDay:23,endDay:22,iconName:"virgo"},{name:"Весы",startMonth:9,startDay:23,endDay:22,iconName:"libra"},{name:"Скорпион",startMonth:10,startDay:23,endDay:21,iconName:"scorpio"},{name:"Стрелец",startMonth:11,startDay:22,endDay:21,iconName:"sagittarius"},{name:"Козерог",startMonth:12,startDay:22,endDay:20,iconName:"capricorn"}],this.uncompletedText=this.input.closest(".field").querySelector(".forms__fields-uncompleted"),this.minYearSpan=this.uncompletedText.querySelector(".birthdate-min-year"),this.maxYearSpan=this.uncompletedText.querySelector(".birthdate-max-year"),this.minYear=this.currentYear-99,this.maxYear=this.currentYear-10,this.minYearSpan.textContent=this.minYear.toString(),this.maxYearSpan.textContent=this.maxYear.toString(),this.existed&&this.checkCompletion()}validate(){const t=super.validate();if(!t)return;if(t.invalidYear)return this.isValid=!1;const e=this.zodiacSigngs.filter((e=>e.startMonth==t.month||e.startMonth+1==t.month)).find(((e,i,s)=>{const n=s[i+1];return!n||(t.day>=e.startDay&&t.day<=n.endDay||(t.day<e.startDay||void 0))})),i=e?e.name:"",s=document.querySelector("input[name='age']"),n=document.querySelector("input[name='zodiac']"),o=new Event("change");if(s&&(s.value=t.age,s.dispatchEvent(o)),n){const t=createElement("span",`zodiac-icon icon-${e.iconName||""}`);n.parentNode.querySelectorAll(".zodiac-icon").forEach((t=>!!t&&t.remove())),n.before(t),n.value=i,n.dispatchEvent(o)}}}class TextInputPhone extends TextInputMulti{constructor(t){super(t),this.findClosestEmpty=this.findClosestEmpty.bind(this),this.init()}init(){this.inputWrapper.addEventListener("click",this.findClosestEmpty),this.inputs=Array.from(this.inputWrapper.querySelectorAll("input[type='text']")),this.inputs.forEach((t=>{t.addEventListener("input",this.typeNumberOnly)}))}findClosestEmpty(t){if(this.inputs.includes(t.target)&&t.target.value)return;const e=this.inputs.find((t=>t.value.length<t.getAttribute("maxlength")))||this.inputs[this.inputs.length-1];e&&e.focus()}checkCompletion(){const t=Boolean(this.inputs.find((t=>{const e=t.getAttribute("maxlength");return t.value.length<e})));this.isCompleted=!t,this.setCompletedState()}}class SelectionInput extends Input{selectionField;inputs;input;type;isCompleted;constructor(t){super(t),this.selectionField=t,this.inputs=Array.from(t.querySelectorAll("input")),this.ariaLabel=this.inputs[0].getAttribute("aria-label"),this.type=this.inputs[0].type,this.name=this.inputs[0].name,"checkbox"===this.type&&(this.inputs=Array.from(document.querySelectorAll(`[name=${this.name}]`)),this.inputs.forEach((t=>t.addEventListener("change",(()=>{this.selectionField.dispatchEvent(new Event("change"))}))))),this.selectionField.addEventListener("change",this.checkCompletion.bind(this))}checkCompletion(){this.setInput();const t="checkbox"==this.type?Boolean(this.input.length>0):Boolean(this.input);t?this.selectionField.classList.remove("__uncomplete"):this.selectionField.classList.add("__uncomplete"),this.isCompleted=t}setInput(){"checkbox"===this.type&&(this.input=this.inputs.filter((t=>t.checked))),"radio"===this.type&&(this.input=this.inputs.find((t=>t.checked))||this.inputs[0])}}class CheckEndWorkYear extends SelectionInput{constructor(t){super(t),this.field=this.inputs[0].closest(".field"),this.formsContainer=this.inputs[0].closest(".forms__container"),this.unrequired=Array.from(this.field.querySelectorAll(".endyear-not-checkbox")).reverse(),this.otherCheckboxes=Array.from(this.formsContainer.querySelectorAll(".endyear-checkbox")),this.checkCompletion(),t.addEventListener("change",this.onChange.bind(this))}checkCompletion(){this.isCompleted=!0}onChange(){this.inputs[0].checked?(this.unrequired=this.unrequired.map((t=>{if(t)return t.remove(),t.cloneNode(!0)})),this.formsContainer.querySelectorAll(".endyear-checkbox").forEach((t=>{this.inputs[0].closest(".checkbox")!==t&&(t.style.display="none")}))):this.unrequired.forEach((t=>{t&&!t.closest("body")&&this.inputs[0].parentNode.after(t),this.formsContainer.querySelectorAll(".endyear-checkbox").forEach((t=>t.style.removeProperty("display")))}))}}class Select extends SelectionInput{selectionField;inputs;isShown;constructor(t){super(t),this.selectionField=t,this.value=t.querySelector(".select__value"),this.inputs=Array.from(t.querySelectorAll("input[type='radio']")),this.isShown=this.selectionField.classList.contains("__shown"),this.toggle=this.toggle.bind(this),this.closeByDocument=this.closeByDocument.bind(this),this.setValues(),this.initOptions(),this.selectionField.addEventListener("click",this.toggle),document.addEventListener("click",this.closeByDocument)}closeByDocument(t){t.target!==this.selectionField&&t.target!==this.value&&this.isShown&&this.hide()}setValues(){this.inputs.forEach((t=>{const e=t.parentNode,i=t.value;e.textContent.includes(i)||e.insertAdjacentHTML("beforeend",i)}))}initOptions(){this.inputs.forEach((t=>{t.addEventListener("change",(()=>{this.value.textContent=t.value}))}))}toggle(){this.selectionField.classList.contains("__shown")?this.hide():this.show()}show(){this.isShown=!0,this.selectionField.classList.add("__shown")}hide(){this.isShown=!1,this.selectionField.classList.remove("__shown")}onDestroy(){this.selectionField.removeEventListener("click",this.toggle),document.removeEventListener("click",this.closeByDocument)}}class SelectChildren extends Select{constructor(t){super(t),this.addButton=this.fieldGroup.querySelector(".add-field"),this.addButton&&(this.addButton.style.display="none"),this.formsContainer=this.fieldGroup.closest(".forms__container"),this.inputs.forEach((t=>{t.addEventListener("change",(()=>this.onChange(t)))})),this.fieldGroup.addEventListener("change",(()=>this.checkCompletion())),this.addButton.addEventListener("click",this.onBtnClick.bind(this))}onBtnClick(t){t.preventDefault();this.formsContainer.querySelectorAll(".children-group").forEach((t=>t.addEventListener("change",this.checkCompletion.bind(this))))}onChange(t){if(this.addButton&&("Есть"===t.value&&this.addButton.style.removeProperty("display"),"Нет"===t.value)){this.addButton.style.display="none";const t=Array.from(this.formsContainer.querySelectorAll(".children-group"));t&&t.forEach((t=>t.remove()))}}checkCompletion(){const t=this.inputs.find((t=>t.checked));if(t&&"Есть"===t.value){const t=Array.from(this.formsContainer.querySelectorAll(".children-group"));if(t.length>0){let e=!0;for(let i of t)if(!i.querySelector("input:checked"))return e=!1;if(this.isCompleted=e,e){const t=this.selectionField.closest(".__uncomplete");this.selectionField.classList.remove("__uncomplete"),t&&t.classList.remove("__uncomplete")}}else this.isCompleted=!1}else super.checkCompletion()}}class Range{rangeBlock;range;rangeSubscales;rangeScale;rangeData;toggler;valueInput;value;name;valueInput;constructor(t){t.querySelector("[data-range-limits]")&&(this.rootElem=t,this.range=t.querySelector(".range"),this.rangeScale=t.querySelector(".range__scale"),this.toggler=t.querySelector(".range__toggler"),this.valueInput=t.querySelector(".range-block__value"),this.name=this.valueInput.name,this.toggler.style.transform="translate(-50%, 0)",this.getData(),window.addEventListener("resize",this.getData.bind(this)),this.setTogglerHandlers(),this.setFocusHandler(),this.valueInput.addEventListener("change",this.checkInputValue.bind(this)),this.setValue(this.rangeData.minValue))}getData(){this.rangeData||(this.rangeSubscales=Array.from(this.rootElem.querySelectorAll(".range__subscale")).map((t=>{const e=t.dataset.rangeLimits.split(", "),i=parseInt(t.dataset.rangeStep);if(e.length<2)throw new Error("Неверно указаны значения data-range-limits в range");const s=parseInt(e[0]),n=parseInt(e[1]);return t.remove(),{step:i,minValue:s,maxValue:n||s}})));const t=this.range.offsetWidth-this.toggler.offsetWidth/1.2,e=this.rangeSubscales[0].minValue,i=this.rangeSubscales[this.rangeSubscales.length-1].maxValue,s=i-e;this.rangeData={width:t,minValue:e,maxValue:i,totalValue:s,step:s/t},this.setValue(this.rangeData.minValue),this.toggler.style.transform="translate(-50%, 0)",this.moveToggler(0)}setTogglerHandlers(){o=o.bind(this),a=a.bind(this);const t=this.toggler,e=this.range,i=this.rangeData.width;let s=getCoords(this.range).left+t.offsetWidth/2;function n(e){if(e.preventDefault(),s=getCoords(this.range).left+t.offsetWidth/2,e.target===t)document.addEventListener("pointermove",o),document.addEventListener("pointerup",a),this.range.classList.add("__moving");else{const n=e.clientX-s;n>=0&&n<=i&&(this.moveToggler(n),t.dispatchEvent(new Event("pointerdown")),o(e))}}function o(t){let e=t.clientX-s;e<0?e=0:e>i&&(e=i);let n=Math.round(this.rangeData.step*e)+this.rangeData.minValue;const o=this.rangeSubscales.find((t=>n>=t.minValue&&n<=t.maxValue)).step,a=parseInt(n/o);n=a*o-this.rangeData.minValue,e=n/this.rangeData.step,this.moveToggler(e);const r=Math.round(this.rangeData.step*e)+this.rangeData.minValue;this.setValue(r)}function a(){document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",a),this.range.classList.remove("__moving")}t.addEventListener("pointerdown",n.bind(this)),e.addEventListener("pointerdown",n.bind(this)),t.ondragstart=()=>!1,e.ondragstart=()=>!1,this.rangeScale.style.width=getComputedStyle(t).left}checkInputValue(t){const e=this.valueInput;let i=parseInt(e.value.replace(/\D/g,""));if(i>this.rangeData.maxValue&&(i=this.rangeData.maxValue),i<this.rangeData.minValue&&(i=this.rangeData.minValue),e.value=i.toLocaleString()+" рублей",t.isTrusted){const t=(i-this.rangeData.minValue)/this.rangeData.step;this.moveToggler(t)}}setValue(t){this.valueInput.value=t,this.valueInput.dispatchEvent(new Event("change"))}moveToggler(t){this.toggler.style.left=`${t}px`,this.rangeScale.style.width=`${t}px`,this.togglerLeft=t;const e=parseInt(t);0===e&&(this.toggler.style.cssText+="transform: translate(-50%, 0%)"),e>=parseInt(this.rangeData.width)&&(this.toggler.style.cssText+="transform: translate(30%, 0%)",this.rangeScale.style.width=`${t+this.toggler.offsetWidth}px`),0!==e&&e!==parseInt(this.rangeData.width)&&this.toggler.style.removeProperty("transform")}setFocusHandler(){this.rootElem.addEventListener("click",(()=>this.valueInput.focus())),this.valueInput.addEventListener("focus",(()=>this.rootElem.classList.add("__focus"))),this.valueInput.addEventListener("blur",(()=>this.rootElem.classList.remove("__focus")))}}class LoadImage{constructor(t){this.imageBlock=t,this.input=t.querySelector("input[type='file']"),this.loadButton=t.querySelector(".load-image__button"),this.contentBlock=t.querySelector(".load-image__content"),this.img=t.querySelector("#load-image__preview"),this.cutSquare=t.querySelector(".cut-square"),this.cutCircle=t.querySelector(".cut-circle"),this.closeButton=t.querySelector(".load-image__close"),this.format=t.querySelector("#load-image__format"),this.size=t.querySelector("#load-image__size"),this.resolution=t.querySelector("#load-image__resolution"),this.info=t.querySelector(".load-image__info"),this.format.addEventListener("change",this.onInputChange.bind(this)),this.size.addEventListener("change",this.onInputChange.bind(this)),this.resolution.addEventListener("change",this.onInputChange.bind(this)),this.cutSquareParams=new CutImage(this.cutSquare,85),this.cutCircleParams=new CutImage(this.cutCircle,85,!0),this.img.addEventListener("click",(()=>modal.createImageModal(this.img.src))),this.info.classList.add("__removed"),this.input.addEventListener("change",this.loadImage.bind(this)),this.closeButton.addEventListener("click",this.remove.bind(this)),this.hideContent()}onInputChange(t){const e=t.target,i=e.value;e.style.width=i.length/1.5+"em"}loadImage(){const t=this.input.files[0],e=new FileReader;t&&(e.readAsDataURL(t),e.onload=()=>{const i=e.result;this.img.src=i;const s=new Image;s.src=i,s.onload=()=>{this.setImgDataValues(t,s),this.origSizes={width:s.width,height:s.height},this.checkCompletion(),this.showContent(),this.cutSquareParams.init(s),this.cutCircleParams.init(s)}})}hideContent(){this.contentBlock.classList.add("__removed"),this.loadButton.classList.remove("__removed"),this.info.classList.add("__removed")}showContent(){this.contentBlock.classList.remove("__removed"),this.loadButton.classList.add("__removed"),this.info.classList.remove("__removed")}remove(){this.input.value="",this.hideContent(),this.checkCompletion()}setImgDataValues(t,e){const i=new Event("change"),s=t.name.split(".");this.format.value=s[s.length-1],this.format.dispatchEvent(i),this.size.value=calcSize(t.size),this.size.dispatchEvent(i),this.resolution.value=e.naturalWidth.toString()+"x"+e.naturalHeight.toString(),this.resolution.dispatchEvent(i)}checkCompletion(){this.input.files[0]?(this.isCompleted=!0,this.imageBlock.classList.remove("__uncomplete")):(this.isCompleted=!1,this.imageBlock.classList.add("__uncomplete"))}}class CutImage{constructor(t,e,i=!1){this.block=t,this.isCircle=i,this.previewSize=e,this.img=t.querySelector(".load-image__small-img"),this.scaleModalCoef=5,this.cutButton=t.querySelector(".load-image__apply-edit"),this.refreshButton=t.querySelector(".load-image__refresh-edit"),this.downloadButton=t.querySelector(".load-image__download-edit"),this.moveXButtonsBlock=t.querySelector(".load-image__move-x-buttons"),this.moveYButtonsBlock=t.querySelector(".load-image__move-y-buttons"),this.scaleButtonsBlock=t.querySelector(".load-image__scale-buttons"),this.initDataTexts(),this.img.ondragstart=()=>!1,this.img.addEventListener("pointerdown",(t=>{const e=t=>{t.clientX===i&&t.clientY===s&&setTimeout((()=>this.createFullSize(!0)),50),this.img.removeEventListener("pointerup",e)};this.onPointerdown(t);const i=t.clientX,s=t.clientY;this.img.addEventListener("pointerup",e)})),this.cutButton.addEventListener("click",(t=>{t.preventDefault(),this.cut()})),this.refreshButton.addEventListener("click",(t=>{t.preventDefault(),this.refresh()})),this.downloadButton.addEventListener("click",(t=>{t.preventDefault(),this.downloadCut()})),this.downloadButton.classList.add("__removed"),this.scaleButtonsBlock&&this.moveYButtonsBlock&&this.moveXButtonsBlock&&this.initControlsButtons()}initDataTexts(t=null,e=null,i=null){this.datablock=this.block.querySelector(".load-image__small-data"),this.datablock&&(this.format=this.datablock.querySelector(".load-image__small-data-format"),this.size=this.datablock.querySelector(".load-image__small-data-size"),this.resolution=this.datablock.querySelector(".load-image__small-data-resolution"),t||e||i?(this.toggleDetails("show"),this.format.textContent=t,this.size.textContent=e,this.resolution.textContent=i):this.toggleDetails("hide"))}toggleDetails(t="hide"){this.datablock&&("hide"===t&&this.datablock.classList.add("__removed"),"show"===t&&this.datablock.classList.remove("__removed"))}downloadCut(){s=s.bind(this),e=e.bind(this);modal.createBasicModal("Скачать изображение",'\n            <div class="radiobuttons">\n                <label class="radiobuttons__item">\n                    <input type="radio" name="modal-window_download-type" value="origin" class="radiobuttons__input">\n                    <svg width="20" height="20" viewBox="0 0 23 23">\n                        <circle cx="10" cy="10" r="9"></circle>\n                        <path\n                            d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z"\n                            class="radiobuttons__item-inner"></path>\n                        <path\n                            d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z"\n                            class="radiobuttons__item-outer"></path>\n                    </svg>\n                    Сохранить оригинальный размер\n                </label>\n                <label class="radiobuttons__item">\n                    <input type="radio" name="modal-window_download-type" value="cut" class="radiobuttons__input">\n                    <svg width="20" height="20" viewBox="0 0 23 23">\n                        <circle cx="10" cy="10" r="9"></circle>\n                        <path\n                            d="M10,7 C8.34314575,7 7,8.34314575 7,10 C7,11.6568542 8.34314575,13 10,13 C11.6568542,13 13,11.6568542 13,10 C13,8.34314575 11.6568542,7 10,7 Z"\n                            class="radiobuttons__item-inner"></path>\n                        <path\n                            d="M10,1 L10,1 L10,1 C14.9705627,1 19,5.02943725 19,10 L19,10 L19,10 C19,14.9705627 14.9705627,19 10,19 L10,19 L10,19 C5.02943725,19 1,14.9705627 1,10 L1,10 L1,10 C1,5.02943725 5.02943725,1 10,1 L10,1 Z"\n                            class="radiobuttons__item-outer"></path>\n                    </svg>\n                    Сохранить уменьшенный размер\n                </label>\n            </div>\n        ',{text:"Скачать",confirmCallback:e},{text:"Отмена"});const t=modal.getModalBody();function e(){const e=Array.from(t.querySelectorAll("input[name='modal-window_download-type']")).find((t=>t.checked))||{value:"cut"},n=this.createFullSize(),o={width:this.origSizes.width,height:this.origSizes.height};let a;switch("origin"!==e.value&&"both"!==e.value||(a=i.call(this)),e.value){case"origin":s(a,o);break;case"cut":s(n.src,n)}}function i(){const t=createElement("canvas");t.width=this.origSizes.width,t.height=this.origSizes.height,t.style.cssText="position: absolute; z-index: -999;";return t.getContext("2d").drawImage(this.origImg,0,0),t.toDataURL("image/png")}function s(t,e=this.createFullSize()){let i=localStorage.getItem("job1_users_downloads");i||(localStorage.setItem("job1_users_downloads",{}),i=localStorage.getItem("job1_users_downloads"));const s=function(){const t=document.querySelector("input[name='name']").value||"Имя",e=document.querySelector("input[name='surname']").value||"Фамилия",i=document.querySelector("input[name='patronymic']").value||"";return i?`${t}-${e}-${i}`:`${t}-${e}`}(),n=i[s]||1,o=`\n                ${s}_${e.width}x${e.height}_000000000${n}\n            `.trim(),a=createElement("a");a.download=o,a.href=t,a.click(),i[s]=n+1,localStorage.setItem("job1_users_downloads",i)}t.classList.add("modal__body--small")}init(t){this.origImg=t,this.origSizes={width:t.width,height:t.height},this.img.src=t.src,this.setImg(t.width,t.height),this.cutButton.classList.add("__removed"),this.refresh()}setImg(t,e){if(t!==e){let i=t/e*this.previewSize,s=this.previewSize;if(i<85){const t=this.previewSize/i;i*=t,s*=t}if(s<85){const t=this.previewSize/s;i*=t,s*=t}this.img.width=i,this.img.height=s}else t===e&&(this.img.width=this.img.height=this.previewSize);this.origSizesScaled={width:this.img.width,height:this.img.height},this.movedX=0,this.movedY=0,this.scaled=1,this.setTransform()}setTransform(){this.cutButton.classList.remove("__removed"),this.img.style.transform=`translate(${this.movedX||0}px, ${this.movedY||0}px)`,this.img.width=this.origSizesScaled.width*this.scaled,this.img.height=this.origSizesScaled.height*this.scaled}cut(){this.cutButton.classList.add("__removed"),this.scaleMin=this.scaled,this.lastCutWidth=this.img.width,this.lastCutHeight=this.img.height,this.fixatedX=Math.abs(this.movedX),this.fixatedY=Math.abs(this.movedY),this.downloadButton.classList.remove("__removed");const t=this.createFullSize(!1),e=calcSize(t.src.length),i=`${t.width}x${t.height}`;this.initDataTexts(t.format,e,i)}refresh(){this.scaleMin=1,this.scaled=1,this.movedY=0,this.movedX=0,this.setTransform(),this.lastCutWidth=0,this.lastCutHeight=0,this.fixatedX=100,this.fixatedY=100,this.scaleModal=this.scaleModalCoef/this.scaled,this.downloadButton.classList.add("__removed"),this.toggleDetails("hide")}initControlsButtons(){const t=this.moveXButtonsBlock.querySelectorAll("[class*='move-x-']"),e=this.moveYButtonsBlock.querySelectorAll("[class*='move-y-']"),i=this.scaleButtonsBlock.querySelectorAll("[class*='scale-']");t.forEach((t=>t.addEventListener("click",this.moveX.bind(this)))),e.forEach((t=>t.addEventListener("click",this.moveY.bind(this)))),i.forEach((t=>t.addEventListener("click",this.scale.bind(this))))}moveX(t){const e=t.target;e.classList.contains("move-x-right")&&this.moveTo("X","-",5),e.classList.contains("move-x-left")&&this.moveTo("X","+",5)}moveY(t){const e=t.target;e.classList.contains("move-y-bottom")&&this.moveTo("Y","-",5),e.classList.contains("move-y-top")&&this.moveTo("Y","+",5)}scale(t){const e=t.target;if(this.scaleMin||(this.scaleMin=1),e.classList.contains("scale-minus")){if(!(this.scaled-.1>=this.scaleMin))return;this.scaled-=.1,this.movedY=this.movedX=0,this.fixatedX=100,this.fixatedY=100,this.lastCutWidth=0,this.lastCutHeight=0}e.classList.contains("scale-plus")&&this.scaled+.1<=5&&(this.scaled+=.1),this.scaleModal=this.scaleModalCoef/this.scaled,this.setTransform()}onPointerdown(t){let e=t.clientX,i=t.clientY;const s=t=>{let s=t.clientX,n=t.clientY;s>e&&this.moveTo("X","+"),s<e&&this.moveTo("X","-"),n>i&&this.moveTo("Y","+"),n<i&&this.moveTo("Y","-"),e=s,i=n},n=()=>{document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",n)};document.addEventListener("pointermove",s),document.addEventListener("pointerup",n)}moveTo(t,e,i=1){const s=getCoords(this.img),n=getCoords(this.img.parentNode);let o=this[`moved${t}`];const a=this.img.width-this.lastCutWidth,r=this.img.height-this.lastCutHeight;switch(e){case"+":o+=i;break;case"-":o-=i}if("-"===e&&(i*=-1),"Y"===t){const e=s.top+i<=n.top&&s.bottom+i>=n.bottom,a=o<=this.fixatedY+r&&o>=this.fixatedY-r;e&&a&&(this[`moved${t}`]=o)}if("X"===t){const e=s.left+i<=n.left&&s.right+i>=n.right,r=o<=this.fixatedX+a&&o>=this.fixatedX-a;e&&r&&(this[`moved${t}`]=o)}this.setTransform()}createFullSize(t=!1){const e=getCoords(this.img),i=getCoords(this.img.parentNode),s=createElement("canvas");s.width=2*this.origSizes.width,s.height=2*this.origSizes.height,s.style.cssText="position: absolute; z-index: -99; opacity: 0",document.body.append(s);s.getContext("2d").drawImage(this.origImg,0,0,this.origImg.width,this.origImg.height);const n=this.img.width/this.previewSize,o=this.origImg.width/n,a=createElement("canvas");a.width=o,a.height=o,a.style.cssText="position: absolute; z-index: -99; opacity: 0",document.body.append(a);const r=a.getContext("2d"),l=i.left-e.left,h=i.top-e.top,c=l*(this.origImg.width/this.img.width),d=h*(this.origImg.height/this.img.height);if(this.isCircle){const t=a.width/2,e=a.height/2,i=Math.min(t,e);r.beginPath(),r.arc(t,e,i,0,2*Math.PI),r.closePath(),r.fill(),r.globalCompositeOperation="source-in",r.drawImage(s,c,d,o,o,0,0,o,o)}else r.drawImage(s,c,d,o,o,0,0,o,o);const u=a.toDataURL("image/png");return t&&modal.createImageModal(u),s.remove(),a.remove(),{src:u,width:a.width,height:a.height,format:"PNG"}}}class Form{constructor(t){this.submit=this.submit.bind(this),this.form=t,this.formSelector="."+this.form.className.split(" ")[0],this.submitButton=this.form.querySelector(".forms__submit"),this.form.addEventListener("submit",this.submit);new MutationObserver((t=>{forms_doInit()})).observe(this.form,{childList:!0})}submit(t){const e=inputParams.filter((t=>{let e=!1;return t.input&&t.input.closest&&(e=t.input.closest(this.formSelector)===this.form),!e&&t.inputs&&t.inputs.forEach((t=>{t&&t.closest&&(e=t.closest(this.formSelector)===this.form)})),e})),i=[];e.forEach((t=>{t.checkCompletion(),t.isCompleted||i.push(t)})),i.length>0?t.preventDefault():(t.preventDefault(),window.location.href=window.location.origin+"/profile/forms/send.html")}}const form=new Form(document.querySelector(".forms"));let inputParams=[];const groupsParams=[],forms_inputSelectors=[{selector:".add-field",classInstance:AddFields},{selector:"[data-add-group-checkbox]",classInstance:AddFieldsCheckbox},{selector:".field__input[type='text']:not([class*='field-init'])",classInstance:TextInput},{selector:".field__input-multi:not([class*='field-init'])",classInstance:TextInputMulti},{selector:".field__input-multi.field-init--date",classInstance:TextInputDate},{selector:".field__input-multi.field-init--birthdate",classInstance:TextInputBirthDate},{selector:".field__input-multi.field-init--phone",classInstance:TextInputPhone},{selector:".field-tags__input",classInstance:TextInputTags},{selector:".text-select__input:not([class*='field-init'])",classInstance:TextSelect},{selector:".field-init--workyear",classInstance:TextSelectWorkYear},{selector:".field__selection",classInstance:SelectionInput},{selector:".select:not([class*='field-init'])",classInstance:Select},{selector:".field-init--select-children",classInstance:SelectChildren},{selector:".checkbox:not([class*='field-init'])",classInstance:SelectionInput},{selector:".field-init--check-end-workyear",classInstance:CheckEndWorkYear},{selector:".load-image",classInstance:LoadImage},{selector:".range-block",classInstance:Range}];function forms_doInit(){setTimeout((()=>{inputParams=inputParams.filter((t=>{let e=!1;return forms_observingNodesKeys.forEach((i=>{t[i]&&t[i].closest&&t[i].closest("body")&&(e=!0)})),e})),forms_inputSelectors.forEach((t=>{Array.from(document.querySelectorAll(t.selector)).forEach((e=>{inputParams.find((t=>{let i=!1;return forms_observingNodesKeys.forEach((s=>{t[s]===e&&(i=!0)})),i}))||inputParams.push(new t.classInstance(e))}))})),Array.from(document.querySelectorAll(".forms__fields-group")).forEach((t=>{groupsParams.find((e=>!!e&&Object.values(e).includes(t)))||groupsParams.push(new InputGroup(t,inputParams))}))}),0)}function observeDocumentBodyOnInputs(){new MutationObserver((t=>{t.find((t=>t.target.classList.contains("text-select__options")))||setTimeout((()=>forms_doInit()),0)})).observe(document.body,{childList:!0,subtree:!0})}forms_doInit(),observeDocumentBodyOnInputs();